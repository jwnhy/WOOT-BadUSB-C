\section{Related Work}
\label{sec:related_work}
\hongyi{Move the stuff about USB protocol to Background}\\
\outline{Attack based on USB 1.0, briefly}\\
\outline{Attack based on USB 2.0, focus on works about application and transport layer}\\
\outline{Attack survey table}\\
\outline{Attack or current works about USB Type-C}\\

In this part, we survey related works on USB attack in Section~\ref{subsec:usb_attack}, and USB defence security in Section \ref{subsec:usb_defence}, respectively.

\subsection{USB Attack}
\label{subsec:usb_attack}
\chaozu{DoS(Fuzzing), Code injection, HID emulation, JFC, our work}
While many USB based attacks have been proposed, these attacks are all tied to the environment of the target devices. In addition, limited to the USB 2.0\cite{usb20} specification, there is no video transferring interface, the control of attack processing is impossibly handled by the attackers without additional processing signal received.\hongyi{What?} One way is to masquerade protocol of attack devices, e.g., Rubbery Ducky \cite{rubber},\cite{badusb}, \cite{rubberducky2020}, \cite{usbbypassing}, \cite{iseeyou}and USBderivery\cite{usbdriver}, when they are connected to the host, they will hide their own functionality with the re-written firmware, that works because of HID enumeration does not verify the firmware of devices. Software running on the host will exfiltrate data or receive commands via the RF interface in \cite{turnip} after modifying the USB table as an additional RF transmitter. What is more, the host's USB software stack generally expects devices to confirm the USB standard, \cite{facedancer} and \cite{syzkaller} take a number of vulnerabilities to the kernel-model with the help of fuzzing technique. These attacks are all using the vulnerabilities of USB protocol, but due to the limitations of USB 2.0, there are no port for video transferring in the devices with USB 2.0, so it is impossible to obtain the real-time screen information of the host, only environment fitted commands and scripts will work in these scenarios.

In a similar way, \cite{duqu} used a user-mode rootkit to hide malicious files on the USB storage device, zero-day exploits is also developed in \cite{zero-day} to automatically execute malware when the storage devices are connected to the host, \cite{brain}, \cite{stuxnet}, \cite{conficker} and \cite{flame} also attack with code injection. \cite{webcam}, \cite{malware},\cite{audioextraction}, \cite{usbee}, and \cite{turnip} used the property that USB devices often do not authenticate the communicating application on the host, they send or receive sensitive data to or from the host devices. Due to the limitation of functionality interface of devices in video transmitting, the accuracy timing for wake up the devices is difficult to handle, e.g., executing the malicious code in host's free time, pausing the execution in the inappropriate time. 

Another kind of attacks for USB \cite{JFC} is to automatically record phone-screen and monitor user's input based on  the Mobile High-Definition Link(MHL) standard. With this approach, it is able to successfully exfiltrate data without the permission on user's side. Due to the limitation of MHL standard, only data exfiltrating works here, an additional conversion tool is necessary. Other attacks for USB to exfiltrate data\cite{smartphone}, \cite{poweremi},\cite{revealing}, \cite{su2017usb}, \cite{usbgpslocator}, \cite{bates2014leveraging}, \cite{badusbhub}, \cite{usbfinger}, \cite{side}, \cite{usbdriver} are to eavesdrop signals to recover the sensitive data at the physical layer. In a similar way, \cite{usbkiller}, \cite{cable}, \cite{usbee}, \cite{turnip} use the RF transmitter to inject signal to cause physical damage to the host machine. Even though the data, including the video data, could be recovered in this way, these attacks for executing malicious code is too difficult to work, and the invisibility is a problem cannot be ignored due to the spacial locality of radio frequency. 


Since USB 3.1 was introduced with USB Type-C in 2013, display port and HDMI connectors have been provided by USB Type-C, transformation for video streaming data is guaranteed with the other attacks, e.g., protocol masquerading,  protocol corruption and code injection. This allows attacker to control users' devices with screen monitoring, attacks for interaction work here.



\chaozu{attack table}\\
\chaozu{enum diagram}


\subsection{USB Defence Security}
\label{subsec:usb_defence}
There are already many defenses proposed against BadUSB attacks and a comprehensive investigation of previous work.\cite{sok}.

From the hardware perspective, BadUSB attack requires `D-' and `D+' pins which are defined by protocol to transmitting data.
Without these pins, data can't be transferred via USB cable. Based on this fact, USB Condom \cite{Condom} is a hardware solution to block data channel by adding blocker in the connector. This blocker can cut off the `D-' and `D+' connection while leave power pins intact.
However, this method poses a great challenge to plug-and-play property of USB, as once it is deployed, it will stop all USB functions other than charging. 

Under the premise of ensuring the full functionality of USB devices, there have been some works trying to improve the security during connection establishment.
Windows Defender ATP\cite{windenfenderwhite} maintains a whitelist of USB devices, only devices on the whitelist are allowed to communicate with the host. This prevents all potential attacks from untrusted devices. But this requires users to have a certain safety awareness and technical background to maintain a valid whitelist. For example, a naive user may add the USB device from unknown sources to his/her whitelist without precaution. In order to overcome this drawback, Mohammadmoradi et al\cite{mohammadmoradi2018making} proposes a strategy to generate such a whitelist automatically. This strategy first generates a unique fingerprint for each device based on its functionality. Then these fingerprints are used to maintain a safe and valid whitelist of USB devices. Apart from whitelist approach, there are also works like TMSUI\cite{yang2015tmsui}, which identifies the unreliable information provided by USB devices and thus defend against BadUSB attack. However, this work relies on the information provided by the device during enumeration. Some modified USB devices may hide their real functionality from the host.

To solve this flaw, GoodUSB\cite{tian2015defending} will report the functionality claimed by the device to user and let user decides whether to authorize. When a device is plugged in, GoodUSB will load its driver but limit its functionality until a series of authorizations is completed. These authorizations are designed to be performed manually. As BadUSB is normally unable to obtain the video stream of the host, it is impossible for an attacker to complete these authorization with automatic script. Thus this defense is sufficient for normal BadUSB attack. But if the attacker has the access to victim's screen, GoodUSB will be bypassed easily as the attacker can just complete these authorization manually and perform subsequent attacks.

After the USB enumeration and driver loading, there are also works trying to archive `defense in depth' against BadUSB attack.
Neuner et al.\cite{neuner2018usblock} prevents BadUSB attacks from malicious flash drive by analyzing the temporal characteristics of BadUSB-like attacks. This defense mechanism is effective because the attacker cannot obtain the screen of the host using just BadUSB. In this case, the malicious device can only inject key stoke in a very short time to reduce the risk of being discovered. This defect causes the typing characteristics of BadUSB to be detectable.  Pham et al. \cite{pham2010optimizing} and odix\cite{OLEA} propose scanning function for files on portable USB devices,\hongyi{What?} and can prevent malicious code from attacking host. What's more, in GoodUSB, a VM is deployed in host to as a honeypot to detect and stop malicious behavior of USB devices. 

In addition to injection attacks, data theft attack is also one of the focuses of academic community. As mentioned in Section~\ref{subsec:usb_attack}, there exist an attack called JFC (juicy film charging)\cite{JFC} which abuses the MHL standard to steal video stream from the victim. In order to mitigate this issue, Meng et al proposed a statistical model using status like GPU/CPU usage to detect JFC attack\cite{meng2018252}.

To summarize, there exists a clear trade-off between the effectiveness and the plug-and-play property. Though hardware disabling solution like USB Condom archives the almost absolute security, the functionality of USB is scarified. Other solutions like GoodUSB or whitelist are either bypassable or insufficient under certain cases. There are many challenges to overcome before an optimal defense is formulated.\hongyi{Are there better way to express this?}

We summarize the former effort in USB attack and defense in Table~\ref{table:attack_vs_defense}, which illustrates the effectiveness of each defense against various attacks including our \tool.
\begin{table*}
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|}
		
		
		\hline
		\diagbox {Defence}{Attack} & Rubbery Ducky\cite{rubber}, \cite{rubberducky2020},USBderivery\cite{usbdriver} & Duqu\cite{duqu} & JFC\cite{JFCImpact}&\cite{smartphone}\cite{poweremi} and \cite{usbdriver}& Armory\\
		
		\hline 
		USB condom \cite{Condom}& Yes & Yes & Yes & Yes & Yes\\
		\hline 
		Pham et al. \cite{pham2010optimizing}, odix\cite{OLEA}& No & ? & No & No & No\\
		\hline 
		TMSUI\cite{yang2015tmsui}& No & Yes? & No & No & No\\
		\hline 
		Windows Defender ATP\cite{windenfenderwhite}& No & Yes? & No & No & No\\
		\hline 
		GoodUSB\cite{tian2015defending}& Yes & Yes & Yes? & No & No \\

		\hline
		Neuner et al.\cite{neuner2018usblock}& Yes & No & No & No & depends? \\
		\hline
		Meng et al\cite{meng2018252}& No & No & Yes & No & ?\\
		\hline
	\end{tabular}
	\linebreak
	\caption{Effectiveness of defense against different attacks}
	\label{table:attack_vs_defense}
\end{table*}




