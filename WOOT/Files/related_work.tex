\section{Related Work}
\label{sec:related_work}

In this part, we survey related works on USB attack in Section~\ref{subsec:usb_attack}, and USB defence security in Section \ref{subsec:usb_defence}, respectively.

\subsection{USB Attack}
\label{subsec:usb_attack}
While many USB based attacks have been proposed, these attacks are all tied to the environment of the target devices. In addition, limited to the USB 2.0\cite{usb20} specification, there is no video transferring interface, accurate attacks couldn't be performed due to lack of user interface (UI). One means of attack is to crash the operating system with the property that the host's USB software stack generally expects devices to confirm the USB standard, \cite{facedancer} and \cite{syzkaller} take a number of vulnerabilities to the kernel-model with the help of fuzzing technique. But code injection and data exfiltrating would not work here. 

\textbf{Attacks based on code injection and data exfiltrating: } \cite{duqu} used a user-mode rootkit to hide malicious files on the USB storage device, zero-day exploits is also developed in \cite{zero-day} to automatically execute malware when the storage devices are connected to the host, \cite{brain, stuxnet, conficker,flame} also attack with code injection. \cite{webcam, malware, audioextraction, usbee, turnip} used the property that USB devices often do not authenticate the communicating application on the host, they send or receive sensitive data to or from the host devices. Due to the limitation of functionality interface of devices in video transmitting, the accuracy timing for wake up the devices is difficult to handle, e.g., executing the malicious code in host's free time, pausing the execution in the inappropriate time. 

\textbf{Attacks based on protocol masquerading:} Protocol masquerading is widely used to hide their own functionality with the re-written firmware, that works because of HID enumeration does not verify the firmware of devices \cite{rubber,badusb, rubberducky2020, usbbypassing, iseeyou, usbdriver}. These works try to hide their own functionality with the re-written firmware when they are connected to the host, software running on the host will exfiltrate data or receive commands via the RF interface in \cite{turnip} after modifying the USB table as an additional RF transmitter. Due to the limitations of USB 2.0, there is no port for video transferring in the devices with USB 2.0, accurate attacks could not be performed without real-time feedback from the host, only environment fitted commands and scripts will work in these scenarios. \cite{JFC} is to automatically record phone-screen and monitor user's input based on the Mobile High-Definition Link(MHL) standard. With this approach, it is able to successfully exfiltrate data without the permission on user's side. Due to the limitation of MHL standard, only data exfiltrating works here, an additional conversion tool is necessary. 

\textbf{Attacks based on physical signal recovering:} Physical radio frequency always contains sensitive data, \cite{smartphone, poweremi,revealing,su2017usb, usbgpslocator, bates2014leveraging, badusbhub, usbfinger, side, usbdriver} are to eavesdrop signals to recover the sensitive data at the physical layer. In a similar way, \cite{usbkiller, cable, usbee, turnip} use the RF transmitter to inject signal to cause physical damage to the host machine. Even though the data, including the video data, could be recovered in this way, these attacks for executing malicious code is too difficult to work, and the invisibility is a problem cannot be ignored due to the spacial locality of radio frequency. 

Since USB 3.1 was introduced with USB Type-C in 2013, display port and HDMI connectors have been provided by USB Type-C, transformation for video streaming data is guaranteed with the other attacks, e.g., protocol masquerading,  protocol corruption and code injection. This allows attacker to control users' devices with screen monitoring, attacks for interaction work here.



\chaozu{attack table}\\
\chaozu{enum diagram}


\subsection{USB Defence Security}
\label{subsec:usb_defence}
There are already many defenses proposed against BadUSB attacks and a comprehensive investigation of previous work.\cite{sok}.
BadUSB attack requires `D-' and `D+' which have been defined by USB protocol since USB 1.0\cite{usb10}.
Without these pins, data can't be transferred via USB cable. USB Condom \cite{Condom} proposed a hardware-based solution to prevent data from being transmitted on data channel by adding special hardware between the USB device and host. This hardware can cut off the `D-' and `D+' and allow only power pins.
However, this method poses a great challenge to easy-to-use property, and once deployed, it will block all USB functions other than charging. 

Under the premise of ensuring the normal operation of all USB pins, some work improve the security of connection establishment.
Windows Defender ATP\cite{windenfenderwhite} maintains a whitelist of USB devices, only if one USB device is in the whitelist can it interact with host through data channel. This prevents all interactions between untrusted devices and the host. But this requires users to have a certain safety awareness. For example, a naive user may add the USB device from unknown sources to his/her whitelist without precaution. Mohammadmoradi et al\cite{mohammadmoradi2018making} propose a strategy to generate a whitelist automatically. Based on the features and functions of the USB devices, Mohammadmoradi et al generate unique fingerprint to each device and classify them. There are also some work like TMSUI\cite{yang2015tmsui}, which is based on the unreliable information provided by USB devices during enumeration to defend against BadUSB attack. 
However, this work relies on the information provided by the device during enumeration. Some USB devices may hide their real functionality from the user.
GoodUSB\cite{tian2015defending} will report the functionality and identity of the device to user and user needs to explicitly authorize. On this basis, GoodUSB loads the corresponding driver for the device, and device can not request other drivers during enumeration or usage. This restricts the device to load only the drivers allowed by the user, but does not prevent the device from using available drivers to attack. For example, a malicious keyboard can type commands without the user's knowledge after enumeration. Because from the user's perspective, he/she must permit a USB-based keyboard the corresponding drivers by authorizing them him/herself. But once the drivers are loaded, the malicious USB-based keyboard can also automatically type in commands.

When the USB device is normally enumerated and can interact with the host, there are also some defenses. 
Neuner et al.\cite{neuner2018usblock} prevent USB key injection attacks from malicious flash drive by analyzing temporal characteristics of BadUSB-like attacks. This defense mechanism is effective as the attacker cannot obtain the screen of the host using BadUSB. In this case, the malicious device can only inject instructions in a very short time to reduce the risk of being discovered. It leads to the typing characteristics of BadUSB devices to be abnormal and detectable. Apart from key injection attacks, malicious file injection can also be detected. Pham et al. \cite{pham2010optimizing} and odix\cite{OLEA} propose scanning function for files on portable USB devices, and can prevent malicious code from attacking host. What's more, in GoodUSB, VM is deployed in host to interact with the USB device to detect malicious behavior like automatic execution of code. In addition to injection attacks, data theft attack is also one of the focuses of the academic community. When the screen data of the mobile device is stolen while charging, the power consumption of the mobile device will change. So Meng et al\cite{meng2018252} detect potential attacks by monitoring and analyzing changes in the usage of CPU and GPU.

Some composite anti-virus systems, like Metascan\cite{OPSWAT}, incorporates some defenses. Metascan can verify digital signature of USB device, sanitize the malicious files in the device to stop malware, and deploy kiosks to protect security-sensitive organizations. However, Metascan also warned users to be cautious of the device plugged into the host, since there is no way to ensure absolute security.

\linyou{logic connection and pros/cons}


We summarize the former effort in USB attack and defense in Table~\ref{table:attack_vs_defense}, which illustrates the effectiveness of each defense against various attacks including our \tool.
\begin{table*}
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|}
		
		
		\hline
		\diagbox {Defence}{Attack} & Rubbery Ducky\cite{rubber}, \cite{rubberducky2020},USBderivery\cite{usbdriver} & Duqu\cite{duqu} & JFC\cite{JFCImpact}&\cite{smartphone}\cite{poweremi} and \cite{usbdriver}& Armory\\
		
		\hline 
		USB condom \cite{Condom}& Yes & Yes & Yes & Yes & Yes\\
		\hline 
		Pham et al. \cite{pham2010optimizing}, odix\cite{OLEA}& No & ? & No & No & No\\
		\hline 
		TMSUI\cite{yang2015tmsui}& No & Yes? & No & No & No\\
		\hline 
		Windows Defender ATP\cite{windenfenderwhite}& No & Yes? & No & No & No\\
		\hline 
		GoodUSB\cite{tian2015defending}& Yes & Yes & Yes? & No & No \\

		\hline
		Neuner et al.\cite{neuner2018usblock}& Yes & No & No & No & depends? \\
		\hline
		Meng et al\cite{meng2018252}& No & No & Yes & No & ?\\
		\hline
	\end{tabular}
	\linebreak
	\caption{Effectiveness of defense against different attacks}
	\label{table:attack_vs_defense}
\end{table*}




