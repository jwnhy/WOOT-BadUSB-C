\section{Related Work}
\label{sec:related_work}
\hongyi{Move the stuff about USB protocol to Background}\\
\outline{Attack based on USB 1.0, briefly}\\
\outline{Attack based on USB 2.0, focus on works about application and transport layer}\\
\outline{Attack survey table}\\
\outline{Attack or current works about USB Type-C}\\

In this part, we survey related works on USB attack in Section~\ref{subsec:usb_attack}, and USB defence security in Section \ref{subsec:usb_defence}, respectively.

\subsection{USB Attack}
\label{subsec:usb_attack}
While many USB based attacks have been proposed, these attacks are all tied to the environment of the target devices. In addition, limited to the USB 2.0\cite{usb20} specification, there is no video transferring interface, the control of attack processing is impossibly handled by the attackers without additional processing signal received. One way is to masquerade protocol of attack devices, e.g., Rubbery Ducky\cite{rubber},\cite{badusb}, \cite{rubberducky2020}, \cite{usbbypassing}, \cite{iseeyou}and USBderivery\cite{usbdriver}, when they are connected to the host, they will hide their own functionality with the re-write functionality interface, that works because of the HID enumeration property for USB identifying. Software running on the host will exfiltrate data or receive commands via the RF interface in \cite{turnip} after modified the USB table with an additional RF transmitter. What is more, the host's USB software stack generally expects devices to confirm the USB standard, \cite{facedancer} and \cite{syzkaller} take a number of vulnerabilities to the kernel-model with the help of fuzzing technology. These attacks are all using the vulnerabilities of the protocol of USB, but due to the limitations of USB 2.0, there are no port for video transformation in the devices with USB 2.0, so it is impossible to handle the real-time screen information of the host, only environment fitted commands and scripts will work in these scenarios, as well as the attack time.

In a similar way, \cite{duqu} used a user-mode rootkit to hide malicious files on the USB storage device, zero-day exploits is also developed in \cite{zero-day} to automatically execute malware when the storage devices are connected to the host, \cite{brain}, \cite{stuxnet}, \cite{conficker} and \cite{flame} also attack with code injection. \cite{webcam}, \cite{malware},\cite{audioextraction}, \cite{usbee}, and \cite{turnip} used the property that USB devices often do not authenticate the communicating application on the host, they send or receive sensitive data to or from the host devices. Due to the limitation of functionality interface of devices for video transformation, the accuracy timing for wake up the devices is difficult to handle, e.g., executing the malicious code in host's free time, pause the execution processing in the inappropriate time. 

Another kind of attacks for USB \cite{JFC} is to automatically record phone-screen and monitor user's input based on  the Mobile High-Definition Link(MHL) standard. With this approach, it is able to successfully exfiltrate data without the permission on user's side. Due to the limitation of MHL standard, only data exfiltrating without other attack script works here, an additional conversion tool is necessary. Others attacks for USB to exfiltrate data\cite{smartphone}, \cite{poweremi},\cite{revealing}, \cite{su2017usb}, \cite{usbgpslocator}, \cite{bates2014leveraging}, \cite{badusbhub}, \cite{usbfinger}, \cite{side}, \cite{usbdriver} are to eavesdrop signal to recovered the sensitive data at the physical layer. In a similar way, \cite{usbkiller}, \cite{cable}, \cite{usbee}, \cite{turnip} use the RF transmitter to inject signal to cause physical damage to the host machine. Even though the data, including the video data, could be recovered in this way, these attacks for executing malicious code is difficult to work, and the invisibility is a problem cannot be ignored due to the spacial locality of radio frequency. 


Since USB 3.1 was introduced with USB Type-C in 2013, display port and HDMI connectors have been provided by USB Type-C, transformation for video streaming data is guaranteed with the other attacks, e.g., protocol masquerading,  protocol corruption and code injection. This allows attacker to control users' devices with screen monitoring, attacks for interaction work here.



\chaozu{attack table}\\
\chaozu{enum diagram}


\subsection{USB Defence Security}
\label{subsec:usb_defence}
There are already some defenses against BadUSB attacks. 
And there has been a comprehensive investigation of previous work.\cite{sok}.
BadUSB attack requires `D-' and `D+' which have been defined by USB protocol since USB 1.0\cite{usb10},
without these special pins, data can't be transferred in the USB cable. USB condom \cite{Condom} proposed a hardware-based solution to prevent data from being transmitted on data channel by adding special hardware between the usb device and host. At this case, `D-' and `D+' are disabled.
However, this method poses a great challenge to ease of use, and once deployed, it will block all USB-supported advanced functions other than charging. Pham et al. \cite{pham2010optimizing} and odix\cite{OLEA} propose scanning function for files on portable USB devices, and can prevent malicious code over malicious devices from attacking host.
There are also some work like TMSUI\cite{yang2015tmsui}, which based on the unreliable information provided by USB devices during enumeration to defend against BadUSB attack.

Since USB devices may hide their real functionality from the user. GoodUSB\cite{tian2015defending} will report the functionality and identity information of the device to the user and the user needs to explicitly specify the target functionality of the device. On this basis, GoodUSB loads the corresponding driver for the device, and device can not request other drivers during enumeration or usage. This restricts the device from loading only the drivers allowed by the user, but does not prevent the device from using available drivers to attack. For example, a malicious keyboard can type commands without the user's knowledge after enumeration. Because from the user's perspect, he must permit a USB-based keyboard the corresponding drivers to allow himself to use keyboard to type, but once the drivers are loaded, the malicious usb-based keyboard can also automatically type commands. What's more, in GoodUSB, VM is deployed in host to interact with the USB device to detect malicious behavior like automatic eqxecution of malicious code.
 
Windows Defender ATP\cite{windenfenderwhite} can maintain a white list of USB devices, only if one USB device is in the white list can it interact with host. This prevents all interactions between untrusted devices and the host. But this reduces the ease of use and requires users to have a certain safety awareness. For example, a naive user may add the USB device he found outdoors to his whitelist without precautions. Mohammadmoradi et al\cite{mohammadmoradi2018making} generate unique fingerprint based on the features and functions of the USB device, thereby building a whitelist of USB devices.

Neuner et al.\cite{neuner2018usblock} prevent USB key injection attacks from malicious flash drive by analyze temporal characteristics of BadUSB-like attacks. This defense mechanism can be successful because the attacker cannot obtain the screen of the host based on the BadUSB under USB2.0, so that the malicious device can only inject instructions in a very short time to prevent the user from discovering. This causes the typing characteristics of BadUSB devices to be detected.

Some composite anti-virus systems, like Windows Defender ATP\cite{windenfender} and Metascan\cite{OPSWAT} can sanitize the malicious files in the device to containment of any malware. However, Metascan warned users to be wary of the device plugged into the computer, since there is currently no way to ensure absolutely security.


For those attacks that use the usb cable to peek at the device screen while the user is charging the mobile device, Meng et al\cite{meng2018252} detect potential attacks by analyzing changes in the usage of CPU and GPU.

We summarize the former effort in USB attack and defense in Table~\ref{table:attack_vs_defense}, which illustrated the effectiveness of each defense against various attacks including our \tool.
\begin{table*}
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|}
		
		
		\hline
		\diagbox {Defence}{Attack} & Rubbery Ducky\cite{rubber}, \cite{rubberducky2020},USBderivery\cite{usbdriver} & Duqu\cite{duqu} & JFC\cite{JFCImpact}&\cite{smartphone}\cite{poweremi} and \cite{usbdriver}& Armory\\
		
		\hline 
		USB condom \cite{Condom}& Yes & Yes & Yes & Yes & Yes\\
		\hline 
		Pham et al. \cite{pham2010optimizing}, odix\cite{OLEA}& No & ? & No & No & No\\
		\hline 
		TMSUI\cite{yang2015tmsui}& No & Yes? & No & No & No\\
		\hline 
		Windows Defender ATP\cite{windenfenderwhite}& No & Yes? & No & No & No\\
		\hline 
		GoodUSB\cite{tian2015defending}& Yes & Yes & Yes? & No & No \\

		\hline
		Neuner et al.\cite{neuner2018usblock}& Yes & No & No & No & depends? \\
		\hline
		Meng et al\cite{meng2018252}& No & No & Yes & No & ?\\
		\hline
	\end{tabular}
	\linebreak
	\caption{Effectiveness of defense against different attacks}
	\label{table:attack_vs_defense}
\end{table*}




