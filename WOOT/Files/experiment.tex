\section{Experiment}
\label{sec:experiment}

\shuqing{Experiment for devices and case study needed.}
For the purpose evaluating effectiveness of \tool, we conduct experiments in three modes on devices with USB Type-C interface.

Overview, \tool in experiments consist of a USB Type-C hub with HDMI and USB port,
a Raspberry Pi 4B with a Wi-Fi chip onboard,
a video capture card adapting HDMI signal to USB camera,
and a normal powerbank with dual outputs.
The powerbank is used to supply a piece of Raspberry Pi 4B and charge victim's device.
The USB Type-C hub adapts USB Type-C to a HDMI port and USB ports.

\outline{Attack Modes}

\subsection{Scripting mode}

In the scripting mode experiment, ``Lenovo Xiaoxin Pro 13 2020'', a PC in Windows 10 with two USB Type-C interfaces, is chosen as the target device. First, we connect \tool to the target device. Then \tool disguises itself as a normal keyboard. Like Rubber Ducky, \tool injects keystrokes at high speeds to perform using the hotkey to pull up a terminal (cmd.exe) and executing the malicious script in the terminal.

Through executing scripts, scripting mode can implant viruses, worms, backdoors, etc., which poses a significant risk to the victim's devices.
However, it can only be used on devices whose terminal is available, which limits its capability to PC.

\subsection{Remote control mode}

In the remote control mode experiment, ``iPad Pro (3rd generation)'', a tablet in iOS 14.3 with a USB Type-C interface, is chosen as the target device. First, we connect \tool to the target device.
Except performing as normal HID devices as Rubber Ducky, \tool can stream the real-time video output from the target device to the attacker through WiFi or GSM.
\tool capture video from USB Type-C Hub's HDMI output via a video capture card, stream video with ``FFmpeg'', a video processing utility and upload video stream to the attacker's device.
With a real-time video stream as an indicator, the attacker can precisely control the position of mouse movements and clicks. The attacker can control the iPad to open applications, peek at the victim's photos, etc.

Remote control mode is ideal for the attacker to control the victim's devices and grab all information shown on the victim's devices. However, it needs user consent for the first time and requires high power consumption to encode video streams and stable network connections.
In the real world, high power consumption will increase the posibilities of being noticed by the victim, and stable network connections is hardly guaranteed.


\subsection{Privacy extraction mode}

In the privacy extraction mode experiment, ``HUAWEI P30'', a smartphone in EMUI 9.1 (Android 9.0 based) with a USB Type-C interface, is chosen as the target device. 
First, we connect \tool to the target device. As remote control mode, \tool capture video from the victim's device and use ``opencv'' to identify ``valuable'' information from video stream. When the victim views text or photoes with text, \tool can use optical character recognition (OCR) to extract text from corresponding video frames. \yechang{hyperlink to OCR?}
For example, extracting the victim's name, photo, address, and ID number when victim is viewing his or her photos of his or her ID card or passport documents,
extracting the victim's payment information when victim is using bank apps or payment apps. Besides, \tool can use ``opencv'' to detect and decode QR codes or barcodes shown on the victim's device, which is expected to extract payment code information in payment apps.
Here is an example of extracting payment code with opencv library in listing~\ref{lst2:qr},

Privacy extraction mode only extracts high-value information for attacker (or highly sensitive information for victim), which is more efficient to  than remote control mode.

\begin{lstlisting}[caption={python script for extracting payment code of victim},label=lst2:qr]
import cv2, qrcode,requests
import pyzbar.pyzbar as pyzbar
def decodeDisplay(video):
    gray = cv2.cvtColor(video, cv2.COLOR_BGR2GRAY)
    barcodes = pyzbar.decode(gray)
    for barcode in barcodes:
        barData = barcode.data.decode()
        barType = barcode.type
        requests.post('<server of attacker>',
            data={
                'data': barData,
                'type': barType
            }
        )
if __name__ == '__main__':
    cam = cv2.VideoCapture(0)
    while True:
        ret, frame = cam.read()
        decodeDisplay(frame)
        if cv2.waitKey(5) == 27:
            break
    cam.release()
    cv2.destroyAllWindows()
\end{lstlisting}


\subsubsection{Case study of QR code payment}

QR code payment is a payment method where payment is typically performed as the following steps:
\ding{182} The payer opens the payment application on his/her mobile device, and present his/her payment QR code to the payee. This QR code is encoded with a globally unique ID to identify the payer's account. 
\ding{183} The payee scan the payment QR code presented by the payer. By presenting this QR code, the payer authorizes proceeding with the payment.
\ding{184} An order generated by this scan is sent to the payment service provider. Then the payment service provider requests the payer to confirm the transaction.
\ding{185} After confirmation, the payment service provider proceed with this transaction and return the payment result to both the payee and the payer.

In the real-world, some payment service providers provide special rules for micropayments purchases. A micropayment is pre-determined by the payment service provider with thresholds in the user agreement. For example, WeChat Pay regards payments less than CNY \textyen 1000 as micropayments. Differing from a typical payment procedure, when micropayments are made, confirmations can be applied automatically without requiring the payer to take further action, which is often encouraged by the payment service provider.

The payment QR code is associated with the payer's account. If a victim's payment code is leaked to an attacker, an attacker can use the victim's payment code to proceed with payments. Furthermore, the attacker can use several micropayments to steal money from the victim's account while leaving the victim unconscious. In summary, the payment QR code is highly sensitive on users' devices.

\subsection{Attack scenario}

It is worth noting that \tool exposed only a type-c cable (from USB Type-C hub),
and \tool will charge his or her device through this cable, which has no difference from ordinary powerbanks. Noticed the similarity between \tool and normal power bank, we conduct a case study on power bank sharing in order to find out the possibility of \tool being mixed into the circulation of shared power banks.

\subsubsection{Case study of Power Bank Sharing}

Power bank sharing provides users with short term rental of power banks. A provider deploys power bank stations in the city. Then, users can rent a power bank from any of the power bank station, charge their device on the trip, return the rented power bank to another station, and pay rent online.

As an example, Brick is such a power bank sharing service provider from Sweden. As Brick's website states, ``Brick prevents your electronics from running out of battery with powerbanks (Bricks) that you can easily rent \& return at our many stations in Stockholm, Gothenburg, Malm√∂ and the rest of Sweden and even Europe.''. \yechang{citation needed}

\yechang{add hyperlink or reference to Brick's website or Brick App on App Store/Google Play.}

\yechang{Add more examples of power bank sharing to show that it is widely used?}

Whiling providing convenience for users, it brings security issues. We notice that the power bank station does not check the integrity of power banks during the rental process, and users are hardly cautious when connecting their devices to the power bank. A malicious user is able to modify his/her rented power bank, return it to a power bank station as normal, and its next user will unknowingly connect to this malicious power bank, which endangers the privacy of user.

\subsection{evaluation}


\begin{table*}
	\centering
	\begin{tabular}{|c|c|c|c|c|}
		\hline
		Application Column  & Application & Private information leaked                       \\
		\hline
		Finance App         & Alipay      & Alipay account, personal assets(blance)          \\
		\hline
		Social  Finance App & WeChat      & WeChat account, blance, chat history             \\
		\hline
		Social App          & QQ          & QQ account, interpersonal nexus, chat history    \\
		\hline
		Social App          & Twitter     & Twitter account, interpersonal nexus             \\
		\hline
		Social App          & Gmail       & Gmail account, mail records                      \\
		\hline
		Finance App         & ICBC        & ICBC account, password, personal assets(blance)  \\
		\hline
		Finance App         & Paypal      & Paypal account, blance, bank accounts            \\
		\hline
		Tool                & Chrome      & Sites visited                                    \\
		\hline
		Tool                & Health      & personal physical metrics      					 \\
		\hline
	\end{tabular}
	\linebreak
	\caption{Information extracted}
	\label{table:information_extracted}
\end{table*}